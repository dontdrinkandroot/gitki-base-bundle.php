Р”Р°РґРµРЅРёС‚Рµ СѓРєР°Р·Р°РЅРёСЏ РІР°Р¶Р°С‚ Р·Р° РѕРїРµСЂР°С†РёРѕРЅРЅР°С‚Р° СЃРёСЃС‚РµРјР° Р“РќРЈ/Р›РёРЅСѓРєСЃ.


1. РќРµРѕР±С…РѕРґРёРј СЃРѕС„С‚СѓРµСЂ
====================

Р•С‚Рѕ РєР°РєРІРѕ С‰Рµ РІРё Рµ РЅРµРѕР±С…РѕРґРёРјРѕ, Р·Р° РґР° РїСѓСЃРЅРµС‚Рµ СЃРѕС„С‚СѓРµСЂР° РЅР° РњРѕСЏС‚Р° Р±РёР±Р»РёРѕС‚РµРєР° вЂ” chitanka:

 - РЈРµР± СЃСЉСЂРІСЉСЂ: Apache СЃ PHP (РІРµСЂСЃРёСЏ РЅР° PHP >= 5.4) РёР»Рё [nginx](http://nginx.org/) СЃ [PHP-FPM](http://php-fpm.org/)
 - MySQL СЃСЉСЂРІСЉСЂ (РІРµСЂСЃРёСЏ >= 4.1)

РџСЂРё Apache С‚СЂСЏР±РІР° РґР° СЃР° РІРєР»СЋС‡РµРЅРё РјРѕРґСѓР»РёС‚Рµ `rewrite` Рё `expires`.

РџСЂРё PHP СЃР° РЅСѓР¶РЅРё СЂР°Р·С€РёСЂРµРЅРёСЏС‚Р° `gd`, `curl`, `xsl` Рё `intl`.


2. РР·С‚РµРіР»СЏРЅРµ
============

РќСѓР¶РЅРѕ Рµ РґР° СЂР°Р·РїРѕР»Р°РіР°С‚Рµ СЃ [git](http://git-scm.com/), Р·Р° РґР° РјРѕР¶Рµ РґР° РєР»РѕРЅРёСЂР°С‚Рµ С…СЂР°РЅРёР»РёС‰РµС‚Рѕ РЅР° СЃРѕС„С‚СѓРµСЂР°.

2.1. Р—Р° РѕРіР»РµРґР°Р»Рѕ
----------------

Р—Р° РѕР±РёРєРЅРѕРІРµРЅРѕ РїСѓСЃРєР°РЅРµ РЅР° РѕРіР»РµРґР°Р»Рѕ РЅР° РњРѕСЏС‚Р° Р±РёР±Р»РёРѕС‚РµРєР° РїРѕР»Р·РІР°Р№С‚Рµ:

	git clone https://github.com/chitanka/chitanka-production.git chitanka

Р©Рµ РїРѕР»СѓС‡РёС‚Рµ РЅРѕРІР° РґРёСЂРµРєС‚РѕСЂРёСЏ chitanka. РќРµРєР° СЃРµ РєР°Р·РІР° `/PATH/TO/chitanka`.

РЎРµРіР° РєРѕРїРёСЂР°Р№С‚Рµ С„Р°Р№Р»Р° `app/config/parameters.yml.dist` РєР°С‚Рѕ `app/config/parameters.yml`.

РЎР»РµРґ С‚РѕРІР° РјРЅРѕРіРѕ Р»РµСЃРЅРѕ РјРѕР¶Рµ РґР° Р°РєС‚СѓР°Р»РёР·РёСЂР°С‚Рµ СЃРѕС„С‚СѓРµСЂР° СЃР°РјРѕ С‡СЂРµР· СЃР»РµРґРЅРёС‚Рµ РєРѕРјР°РЅРґРё:

	cd /PATH/TO/chitanka && git pull

2.2. Р—Р° СЂР°Р·СЂР°Р±РѕС‚С‡РёС†Рё
---------------------

РќР°Р№-РЅР°РїСЂРµРґ РёРЅСЃС‚Р°Р»РёСЂР°Р№С‚Рµ [composer](https://getcomposer.org/download/), Р°РєРѕ РІСЃРµ РѕС‰Рµ РЅРµ СЂР°Р·РїРѕР»Р°РіР°С‚Рµ СЃ РЅРµРіРѕ. РќСЏРјР° Р·РЅР°С‡РµРЅРёРµ РІ РєРѕСЏ РґРёСЂРµРєС‚РѕСЂРёСЏ С‰Рµ СЃР»РѕР¶РёС‚Рµ РёР·РїСЉР»РЅРёРјРёСЏ РјСѓ С„Р°Р№Р» composer.phar, РЅРѕ Рµ РїСЂРµРїРѕСЂСЉС‡РёС‚РµР»РЅРѕ РґР° Рµ РІ РЅСЏРєРѕСЏ РіР»РѕР±Р°Р»РЅР° РґРёСЂРµРєС‚РѕСЂРёСЏ, Р·Р° РґР° РјРѕР¶Рµ РґР° РіРѕ РёР·РїРѕР»Р·РІР°С‚Рµ Рё Р·Р° РґСЂСѓРіРё РїСЂРѕРµРєС‚Рё. РџРѕ Р¶РµР»Р°РЅРёРµ РјРѕР¶Рµ РґР° РїСЂРµРёРјРµРЅСѓРІР°С‚Рµ Рё СЃР°РјРёСЏ С„Р°Р№Р», РЅР°РїСЂ. `/usr/local/bin/composer`. Р’Р°Р¶РЅРѕ Рµ РґР° Р·Р°РїРѕРјРЅРёС‚Рµ РєСЉРґРµ СЃРµ РЅР°РјРёСЂР° С‚РѕР№, Р·Р° РґР° РјРѕР¶Рµ РґР° РіРѕ РёР·РІРёРєРІР°С‚Рµ СЃР»РµРґ С‚РѕРІР°.

РЎРµРіР° РєР»РѕРЅРёСЂР°Р№С‚Рµ С…СЂР°РЅРёР»РёС‰РµС‚Рѕ РЅР° chitanka:

	git clone https://github.com/chitanka/chitanka.git

Р©Рµ РїРѕР»СѓС‡РёС‚Рµ РЅРѕРІР° РґРёСЂРµРєС‚РѕСЂРёСЏ chitanka. РќРµРєР° СЃРµ РєР°Р·РІР° `/PATH/TO/chitanka`. РЎР»РµРґ С‚РѕРІР° РёР·РїСЉР»РЅРµС‚Рµ РІ РєРѕРЅР·РѕР»Р°С‚Р°:

	cd /PATH/TO/chitanka
	php /PATH/TO/composer.phar install

РўРѕРІР° С‰Рµ РѕС‚РЅРµРјРµ РѕРєРѕР»Рѕ РґРµСЃРµС‚РёРЅР° РјРёРЅСѓС‚Рё. Р’ РєСЂР°СЏ С‰Рµ СЃРµ РїРѕСЏРІРё Р·Р°РїРёС‚РІР°РЅРµ Р·Р° РїРѕРїСЉР»РІР°РЅРµ РЅР° РѕРїСЂРµРґРµР»РµРЅРё РїР°СЂР°РјРµС‚СЂРё. Р’ СЃРєРѕР±Рё СЃРµ РЅР°РјРёСЂР° СЃС‚РѕР№РЅРѕСЃС‚С‚Р° РїРѕ РїРѕРґСЂР°Р·Р±РёСЂР°РЅРµ. Р—Р°СЃРµРіР° СЃР° РІР°Р¶РЅРё СЃР°РјРѕ С‚РµР·Рё Р·Р° Р±Р°Р·Р°С‚Р° РѕС‚ РґР°РЅРЅРё (database_xxx). Р—Р° `database_driver` РѕСЃС‚Р°РІРµС‚Рµ `pdo_mysql`. РџСЂРё РґСЂСѓРіРёС‚Рµ РїСЂРѕСЃС‚Рѕ РЅР°С‚РёСЃРЅРµС‚Рµ Enter.

Р—Р°РїРёСЃР°РЅРёС‚Рµ РїР°СЂР°РјРµС‚СЂРё СЃРµ РЅР°РјРёСЂР°С‚ РІСЉРІ С„Р°Р№Р»Р° `app/config/parameters.yml` Рё РјРѕРіР°С‚ РґР° Р±СЉРґР°С‚ РїСЂРѕРјРµРЅСЏРЅРё РїРѕ РІСЃСЏРєРѕ РІСЂРµРјРµ РїРѕ-РєСЉСЃРЅРѕ.

РџРѕСЃР»РµРґРІР°С‰РёС‚Рµ РѕР±РЅРѕРІСЏРІР°РЅРёСЏ РЅР° СЃРѕС„С‚СѓРµСЂР° РјРѕРіР°С‚ РґР° СЃС‚Р°РІР°С‚ С‡СЂРµР·:

	cd /PATH/TO/chitanka && git pull && php /PATH/TO/composer.phar update


3. РќР°СЃС‚СЂРѕР№РєР°
============

РЎРµРіР° Рµ РЅСѓР¶РЅРѕ РґР° СЂР°Р·СЂРµС€РёС‚Рµ РЅР° СЃРѕС„С‚СѓРµСЂР° (СЃСЉСЂРІСЉСЂР°) РґР° РїРёС€Рµ РІ РґРёСЂРµРєС‚РѕСЂРёРёС‚Рµ `var/cache`, `var/log`, `var/spool` Рё `web/cache`.

РўРѕРІР° СЃС‚Р°РІР° РЅР°Р№-Р»РµСЃРЅРѕ РїСЂРµР· РєРѕРјР°РЅРґРЅРёСЏ СЂРµРґ:

	cd /PATH/TO/chitanka
	chmod -R a+w var/cache var/log var/spool web/cache

РђРєРѕ СЂР°Р·РїРѕР»Р°РіР°С‚Рµ Рё СЃ С„Р°Р№Р»Р° СЃСЉСЃ СЃСЉРґСЉСЂР¶Р°РЅРёРµС‚Рѕ РЅР° Р±РёР±Р»РёРѕС‚РµРєР°С‚Р° (С‚РµРєСЃС‚РѕРІРµ, РёР·РѕР±СЂР°Р¶РµРЅРёСЏ), РіРѕ СЂР°Р·Р°СЂС…РёРІРёСЂР°Р№С‚Рµ РІ РґРёСЂРµРєС‚РѕСЂРёСЏС‚Р° /PATH/TO/chitanka/web:

	tar zxvf chitanka-content.tar.gz -C /PATH/TO/chitanka/web


4. Р‘Р°Р·Р° РѕС‚ РґР°РЅРЅРё
================

РџСЉСЂРІРѕ СЃРё СЃРІР°Р»РµС‚Рµ [Р°РєС‚СѓР°Р»РЅР° РІРµСЂСЃРёСЏ РЅР° Р±Р°Р·Р°С‚Р° РѕС‚ РґР°РЅРЅРё РЅР° РњРѕСЏС‚Р° Р±РёР±Р»РёРѕС‚РµРєР°](http://download.chitanka.info/chitanka.sql.gz).

РЎР»РµРґ С‚РѕРІР° СЃСЉР·РґР°Р№С‚Рµ РЅРѕРІР° Р±Р°Р·Р° РѕС‚ РґР°РЅРЅРё СЃ РёРјРµ chitanka. РќР°РїСЂРёРјРµСЂ С‚Р°РєР°:

	mysql -u root -e "CREATE DATABASE chitanka"

РђРєРѕ root РёРјР° РїР°СЂРѕР»Р°, РїРѕР»Р·РІР°Р№С‚Рµ `mysql -u root -p`.

РџРѕСЃР»Рµ РІРјСЉРєРЅРµС‚Рµ СЃСЉРґСЉСЂР¶Р°РЅРёРµС‚Рѕ РЅР° С„Р°Р№Р»Р° `chitanka.sql.gz` РІ РЅРѕРІР°С‚Р° Р±Р°Р·Р°:

	gunzip -c chitanka.sql.gz | mysql -u root chitanka

РџСЂРё Р¶РµР»Р°РЅРёРµ РјРѕР¶Рµ РґР° СЃСЉР·РґР°РґРµС‚Рµ СЃРїРµС†РёР°Р»РµРЅ РїРѕС‚СЂРµР±РёС‚РµР» СЃ РґРѕСЃС‚СЉРї СЃР°РјРѕ РґРѕ С‚Р°Р·Рё Р±Р°Р·Р° РѕС‚ РґР°РЅРЅРё.

Р’СЉРІ С„Р°Р№Р»Р° `app/config/parameters.yml` Рµ РїРѕСЃРѕС‡РµРЅР° РєРѕРЅС„РёРіСѓСЂР°С†РёСЏС‚Р° Р·Р° Р±Р°Р·Р°С‚Р° РѕС‚ РґР°РЅРЅРё. РџРѕ РїРѕРґСЂР°Р·Р±РёСЂР°РЅРµ С‚РѕР·Рё С„Р°Р№Р» СЃСЉРґСЉСЂР¶Р°:

	database_host:      localhost
	database_name:      chitanka
	database_user:      root
	database_password:  ~

РўРѕРІР° С‰Рµ СЂРµС‡Рµ, С‡Рµ Р±Р°Р·Р°С‚Р° РѕС‚ РґР°РЅРЅРё СЃРµ РЅР°РјРёСЂР° РЅР° Р»РѕРєР°Р»РЅРёСЏ РєРѕРјРїСЋС‚СЉСЂ Рё СЃРµ РЅР°СЂРёС‡Р° chitanka. Р—Р° РґРѕСЃС‚СЉРї РґРѕ РЅРµСЏ С‰Рµ СЃРµ РїРѕР»Р·РІР° РїРѕС‚СЂРµР±РёС‚РµР»СЏС‚ root, РєРѕР№С‚Рѕ РЅСЏРјР° РїР°СЂРѕР»Р°.

РђРєРѕ СЂРµС€РёС‚Рµ РґР° РїРѕР»Р·РІР°С‚Рµ РґСЂСѓРіР° РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ, РЅР°РїСЂ. root СЃ РїР°СЂРѕР»Р° РёР»Рё РїСЉРє СЃСЉРІСЃРµРј РґСЂСѓРі РїРѕС‚СЂРµР±РёС‚РµР», РїСЂРѕСЃС‚Рѕ РІСЉРІРµРґРµС‚Рµ РЅСѓР¶РЅРёС‚Рµ РґР°РЅРЅРё РІСЉРІ С„Р°Р№Р»Р° `app/config/parameters.yml`.


5. РќР°СЃС‚СЂРѕР№РєР° РЅР° СЃСЉСЂРІСЉСЂР°
=======================

Р•С‚Рѕ РїСЂРёРјРµСЂРЅРё РєРѕРЅС„РёРіСѓСЂР°С†РёРё Р·Р° Apache 2 Рё nginx. РќР° РјСЏСЃС‚РѕС‚Рѕ РЅР° /PATH/TO Р·Р°РїРёС€РµС‚Рµ СЃСЉРѕС‚РІРµС‚РЅРёС‚Рµ РґРёСЂРµРєС‚РѕСЂРёРё. Р—Р° РёРјРµ РЅР° СЃСЉСЂРІСЉСЂР° РїРѕ-РґРѕР»Сѓ СЃРµ РїРѕР»Р·РІР° `chitanka.local`, РЅРѕ РјРѕР¶Рµ РґР° РіРѕ СЃРјРµРЅРёС‚Рµ СЃ РєР°РєСЉРІС‚Рѕ РґРѕРјРµР№РЅ РїРѕР¶РµР»Р°РµС‚Рµ.

5.1. Apache 2
-------------

РќР°СЃС‚СЂРѕР№С‚Рµ РЅРѕРІ РІРёСЂС‚СѓР°Р»РµРЅ С…РѕСЃС‚ РїСЂРё Р°РїР°С‡Р° (Apache 2), РєР°С‚Рѕ РґРѕР±Р°РІРёС‚Рµ С‚РѕРІР° РІ РєРѕРЅС„РёРіСѓСЂР°С†РёСЏС‚Р° РјСѓ:

	<VirtualHost *:80>
		DocumentRoot /PATH/TO/chitanka/web
		ServerName chitanka.local
		<Directory "/PATH/TO/chitanka/web">
			AllowOverride All
			Allow from All
		</Directory>
		LogLevel warn
		CustomLog /PATH/TO/LOG/chitanka.access.log common
		ErrorLog /PATH/TO/LOG/chitanka.error.log
	</VirtualHost>

5.2. nginx
----------

	server {
		listen 80;

		server_name chitanka.local;
		root /PATH/TO/chitanka/web;

		access_log /PATH/TO/LOG/chitanka.access.log;
		error_log /PATH/TO/LOG/chitanka.error.log;

		location / {
			index index.php;
			try_files $uri $uri/ /index.php$is_args$args;
		}

		location ~ /(index|index_dev)\.php($|/) {
			fastcgi_pass 127.0.0.1:9000;
			# or thru a unix socket
			#fastcgi_pass unix:/var/run/php5-fpm.sock;
			fastcgi_split_path_info ^(.+\.php)(/.*)$;
			include fastcgi_params;
		}

		location ~ /(css|js|thumb) {
			expires 1y;
			try_files /cache$request_uri @asset_generator;
		}
		location @asset_generator {
			rewrite ^/(css|js|thumb)/(.+) /$1/index.php?$2;
		}

		location ~* \.(eot|otf|ttf|woff)$ {
			add_header Access-Control-Allow-Origin *;
		}
	}

5.3. РќР°СЃС‚СЂРѕР№РєР° РЅР° РґРѕРјРµР№РЅР°
-------------------------

РџРѕСЃР»Рµ РІ [/etc/hosts](http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system) РґРѕР±Р°РІРµС‚Рµ СЃР»РµРґРЅРѕС‚Рѕ:

	127.0.0.1	chitanka.local

РўР°РєР° РґРѕРјРµР№РЅСЉС‚ `chitanka.local` С‰Рµ СЃРµ СЂР°Р·РїРѕР·РЅР°РІР° РѕС‚ СЃРёСЃС‚РµРјР°С‚Р° РІРё.


6. РџСѓСЃРєР°РЅРµ
==========

РђРєРѕ РІСЃРёС‡РєРѕ Рµ РјРёРЅР°Р»Рѕ РїРѕ РїР»Р°РЅ, РѕС‚РІРѕСЂРµС‚Рµ <http://chitanka.local> Рё СЂР°Р·РіР»РµРґР°Р№С‚Рµ РІР°С€Р°С‚Р° РІРµСЂСЃРёСЏ РЅР° РњРѕСЏС‚Р° Р±РёР±Р»РёРѕС‚РµРєР°.


7. РћР±РЅРѕРІСЏРІР°РЅРµ
=============

РђРІС‚РѕРјР°С‚РёС‡РЅРѕС‚Рѕ РѕР±РЅРѕРІСЏРІР°РЅРµ РЅР° СЃРѕС„С‚СѓРµСЂР° Рё РЅР° СЃСЉРґСЉСЂР¶Р°РЅРёРµС‚Рѕ РЅР° Р±РёР±Р»РёРѕС‚РµРєР°С‚Р° СЃС‚Р°РІР° С‡СЂРµР· СЃРєСЂРёРїС‚Р° `bin/update`. Р•С‚Рѕ РїСЂРёРјРµСЂРЅР° РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ Р·Р° [Cron](https://en.wikipedia.org/wiki/Cron), СЃ РєРѕСЏС‚Рѕ РІСЃРµРєРё РґРµРЅ РІ 0 С‡Р°СЃР° С‰Рµ СЃРµ РёР·РІСЉСЂС€РІР° РѕР±РЅРѕРІСЏРІР°РЅРµ РЅР° СЃРёСЃС‚РµРјР°С‚Р°:

    0 0 * * *    /PATH/TO/chitanka/bin/update


8. РџРѕРјРѕС‰ СЃ РёРЅСЃС‚Р°Р»Р°С†РёСЏС‚Р°
=======================

РђРєРѕ РёРјР°С‚Рµ РїСЂРѕР±Р»РµРјРё СЃ РёРЅСЃС‚Р°Р»Р°С†РёСЏС‚Р° РёР»Рё РїСЉРє РёСЃРєР°С‚Рµ РґР° РїРѕРјРѕРіРЅРµС‚Рµ Р·Р° РїРѕРґРѕР±СЂСЏРІР°РЅРµС‚Рѕ РЅР° С‚РµР·Рё СѓРєР°Р·Р°РЅРёСЏ, РїРѕСЃРµС‚РµС‚Рµ СЃС‚СЂР°РЅРёС†Р°С‚Р° <http://wiki.chitanka.info/Install>.
